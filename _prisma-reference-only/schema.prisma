// âš ï¸ ==================== ì°¸ì¡°ìš© ìŠ¤í‚¤ë§ˆ ====================
// âš ï¸ ì´ íŒŒì¼ì€ ë” ì´ìƒ ì‚¬ìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤!
// âš ï¸ Drizzle ORMìœ¼ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ë˜ì—ˆìŠµë‹ˆë‹¤.
// âš ï¸ ì‹¤ì œ ìŠ¤í‚¤ë§ˆ: src/lib/db/schema.ts
// âš ï¸ ========================================================
//
// ğŸ“‹ ì´ íŒŒì¼ì€ ë‹¤ìŒ ëª©ì ìœ¼ë¡œë§Œ ìœ ì§€ë©ë‹ˆë‹¤:
//   - Drizzle ìŠ¤í‚¤ë§ˆ ì‘ì„± ì‹œ ì°¸ì¡°
//   - ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡° íˆìŠ¤í† ë¦¬ í™•ì¸
//   - ë§ˆì´ê·¸ë ˆì´ì…˜ ë¹„êµìš©
//
// ========================================================

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@map("accounts")
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sessions")
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
  @@map("verification_tokens")
}

model User {
  id            String         @id @default(cuid())
  name          String?
  email         String         @unique
  password      String?
  image         String?
  role          String         @default("user")
  provider      String?
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  firstName     String?
  lastName      String?
  phone         String?
  newsletter    Boolean        @default(false)
  notifications Boolean        @default(true)
  emailVerified DateTime?
  accounts      Account[]
  addresses     Address[]
  cartItems     CartItem[]
  orders        Order[]
  sessions      Session[]
  wishlist      WishlistItem[]
  questions     ProductQuestion[]
  answers       ProductAnswer[]

  @@map("users")
}

model Address {
  id               String  @id @default(cuid())
  recipientName    String
  phone            String
  zipCode          String
  address          String  // ë„ë¡œëª… ë˜ëŠ” ì§€ë²ˆ ì£¼ì†Œ
  detailAddress    String  // ìƒì„¸ì£¼ì†Œ
  deliveryRequest  String  @default("ë¬¸ ì•")
  entranceCode     String?
  isDefault        Boolean @default(false)
  userId           String
  user             User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("addresses")
}

model CartItem {
  id                 String  @id @default(cuid())
  quantity           Int     @default(1)
  productId          String
  title              String
  price              Float
  image              String?
  category           String?
  brand              String?
  discountPercentage Float?
  userId             String
  variantId          String? // ì˜µì…˜ìƒí’ˆì¸ ê²½ìš° ì„ íƒí•œ ì˜µì…˜ ì¡°í•©
  selectedOptions    Json?   // ì„ íƒëœ ì˜µì…˜ ì •ë³´ {color: "ë¸”ë™", size: "265"}
  user               User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  product            Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  variant            ProductVariant? @relation(fields: [variantId], references: [id], onDelete: SetNull)

  @@unique([userId, productId, variantId])
  @@map("cart_items")
}

model WishlistItem {
  id                 String  @id @default(cuid())
  productId          String
  title              String
  price              Float
  image              String?
  category           String?
  brand              String?
  discountPercentage Float?
  userId             String
  user               User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  product            Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([userId, productId])
  @@map("wishlist_items")
}

model Product {
  id                    String   @id @default(cuid())
  title                 String
  description           String   @db.Text
  price                 Float
  discountPercentage    Float    @default(0)
  rating                Float    @default(0)
  stock                 Int      @default(0)
  brand                 String?
  category              String
  thumbnail             String
  images                String[] // Array of image URLs (up to 5 images)
  detailImages          String[] // Array of detail page images (up to 5 images)
  tags                  String[] // Array of tags
  sku                   String   @unique
  weight                Float?
  dimensions            Json?    // {width, height, depth}
  warrantyInformation   String?
  shippingInformation   String?
  returnPolicy          String?
  minimumOrderQuantity  Int      @default(1)
  availabilityStatus    String   @default("In Stock")
  meta                  Json?    // {barcode, qrCode, createdAt, updatedAt}
  isActive              Boolean  @default(true)
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  // â­ í•„ìˆ˜ í‘œê¸° ì •ë³´
  productName           String?  // í’ˆëª… ë° ëª¨ë¸ëª…
  modelNumber           String?  // ëª¨ë¸ëª…
  size                  String?  // í¬ê¸°
  material              String?  // ì¬ì§ˆ
  releaseDate           String?  // ì¶œì‹œë…„ì›”
  manufacturer          String?  // ì œì¡°ì(ìˆ˜ì…ì)
  madeInCountry         String?  // ì œì¡°êµ­
  warrantyStandard      String?  // í’ˆì§ˆë³´ì¦ê¸°ì¤€
  asResponsible         String?  // A/S ì±…ì„ìì™€ ì „í™”ë²ˆí˜¸
  kcCertification       String?  // KC ì¸ì¦ì •ë³´
  color                 String?  // ìƒ‰ìƒ
  productComposition    String?  // ì œí’ˆ êµ¬ì„±
  detailedSpecs         String?  // ìƒí’ˆë³„ ì„¸ë¶€ ì‚¬ì–‘

  // â­ ë°°ì†¡ ì •ë³´
  shippingMethod        String?  // ë°°ì†¡ë°©ë²• (ì‹ ì„ /ëƒ‰ì¥/ëƒ‰ë™ ë“±)
  shippingCost          String?  // ë°°ì†¡ë¹„
  bundleShipping        String?  // ë¬¶ìŒë°°ì†¡ ì—¬ë¶€
  shippingPeriod        String?  @db.Text // ë°°ì†¡ê¸°ê°„

  // â­ êµí™˜/ë°˜í’ˆ ì •ë³´
  exchangeReturnCost    String?  @db.Text // êµí™˜/ë°˜í’ˆ ë¹„ìš©
  exchangeReturnDeadline String? @db.Text // êµí™˜/ë°˜í’ˆ ì‹ ì²­ ê¸°ì¤€ì¼
  exchangeReturnLimitations String? @db.Text // êµí™˜/ë°˜í’ˆ ì œí•œì‚¬í•­
  clothingLimitations   String?  @db.Text // ì˜ë¥˜/ì¡í™” ì œí•œì‚¬í•­
  foodLimitations       String?  @db.Text // ì‹í’ˆ/í™”ì¥í’ˆ ì œí•œì‚¬í•­
  electronicsLimitations String? @db.Text // ì „ì/ê°€ì „ ì œí•œì‚¬í•­
  autoLimitations       String?  @db.Text // ìë™ì°¨ìš©í’ˆ ì œí•œì‚¬í•­
  mediaLimitations      String?  @db.Text // CD/DVD/GAME/BOOK ì œí•œì‚¬í•­

  // â­ íŒë§¤ì ì •ë³´
  sellerName            String?  // íŒë§¤ìëª…
  sellerPhone           String?  // íŒë§¤ì ì „í™”ë²ˆí˜¸
  sellerLegalNotice     String?  @db.Text // ë²•ì  ê³ ì§€ì‚¬í•­

  // â­ ì˜µì…˜ ì‹œìŠ¤í…œ
  hasOptions            Boolean  @default(false) // ì˜µì…˜ ìƒí’ˆ ì—¬ë¶€ (false: ë‹¨ì¼ìƒí’ˆ, true: ì˜µì…˜ìƒí’ˆ)

  // Relations
  cartItems             CartItem[]
  wishlistItems         WishlistItem[]
  orderItems            OrderItem[]
  questions             ProductQuestion[]
  options               ProductOption[]   // ì˜µì…˜ ì •ì˜ (ìƒ‰ìƒ, ì‚¬ì´ì¦ˆ ë“±)
  variants              ProductVariant[]  // ì˜µì…˜ ì¡°í•©ë³„ ìƒí’ˆ

  @@map("products")
}

// â­ ìƒí’ˆ ì˜µì…˜ (ìƒ‰ìƒ, ì‚¬ì´ì¦ˆ ë“±ì˜ ì˜µì…˜ íƒ€ì… ì •ì˜)
model ProductOption {
  id          String   @id @default(cuid())
  productId   String
  product     Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  name        String   // ì˜µì…˜ëª… (ìƒ‰ìƒ, ì‚¬ì´ì¦ˆ, ì ìš©ëª¨ë¸ ë“±)
  values      String[] // ì˜µì…˜ê°’ ë°°ì—´ (ë¸”ë™, í™”ì´íŠ¸, ë„¤ì´ë¹„ ë“±)
  order       Int      @default(0) // ì˜µì…˜ ìˆœì„œ (1ë²ˆ ì˜µì…˜, 2ë²ˆ ì˜µì…˜...)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("product_options")
}

// â­ ìƒí’ˆ ë³€í˜• (ì˜µì…˜ ì¡°í•©ë³„ ê°€ê²©/ì¬ê³ )
model ProductVariant {
  id                String   @id @default(cuid())
  productId         String
  product           Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  optionCombination Json     // ì˜µì…˜ ì¡°í•© {color: "ë¸”ë™", size: "265"}
  sku               String?  // íŒë§¤ììƒí’ˆì½”ë“œ
  price             Float    // íŒë§¤ê°€
  originalPrice     Float?   // ì •ìƒê°€ (í• ì¸ ì „)
  stock             Int      @default(0) // ì¬ê³ 
  isActive          Boolean  @default(true)
  image             String?  // ì˜µì…˜ë³„ ì´ë¯¸ì§€ (ìƒ‰ìƒ ì¸ë„¤ì¼ìš©)
  barcode           String?  // ìƒí’ˆ ë°”ì½”ë“œ
  modelNumber       String?  // ëª¨ë¸ë²ˆí˜¸
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // Relations
  cartItems         CartItem[]
  orderItems        OrderItem[]

  @@map("product_variants")
}

model Order {
  id              String      @id @default(cuid())
  orderId         String      @unique
  status          String      @default("pending")
  paymentStatus   String      @default("pending")
  paymentMethod   String      @default("online")
  totalAmount     Float
  currency        String      @default("KRW")
  shippingAddress Json
  billingAddress  Json?
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  userId          String
  orderItems      OrderItem[]
  user            User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  // í† ìŠ¤í˜ì´ë¨¼ì¸  ê²°ì œ ì •ë³´
  tossOrderId          String?           // í† ìŠ¤í˜ì´ë¨¼ì¸  ì£¼ë¬¸ ID
  tossPaymentId        String?           // í† ìŠ¤í˜ì´ë¨¼ì¸  ê²°ì œ ID (ê²°ì œ ìˆ˜ë‹¨)
  tossPaymentKey       String?           @unique  // ê²°ì œ í‚¤ (ê²€ì¦ìš©)
  tossPaymentMethod    String?           // ê²°ì œ ìˆ˜ë‹¨ (CARD, TRANSFER, VIRTUAL_ACCOUNT ë“±)
  tossCardCompany      String?           // ì¹´ë“œì‚¬ (ì‹ ìš©ì¹´ë“œë§Œ)
  tossCardNumber       String?           // ë§ˆìŠ¤í‚¹ëœ ì¹´ë“œë²ˆí˜¸
  tossApprovalNumber   String?           // ìŠ¹ì¸ë²ˆí˜¸
  tossFailureReason    String?           // ê²°ì œ ì‹¤íŒ¨ ì‚¬ìœ  (ì‹¤íŒ¨ì‹œë§Œ)
  tossReceipt          Json?             // ì˜ìˆ˜ì¦ ì •ë³´
  tossPaymentAttempts  Int               @default(0)  // ê²°ì œ ì‹œë„ íšŸìˆ˜
  lastTossAttempt      DateTime?         // ë§ˆì§€ë§‰ ê²°ì œ ì‹œë„ ì‹œê°„

  @@map("orders")
}

model OrderItem {
  id                 String  @id @default(cuid())
  quantity           Int
  productId          String
  title              String
  price              Float
  total              Float
  image              String?
  category           String?
  originalPrice      Float?
  discountPercentage Float?
  orderId            String
  variantId          String? // ì˜µì…˜ìƒí’ˆì¸ ê²½ìš° ì„ íƒí•œ ì˜µì…˜ ì¡°í•©
  selectedOptions    Json?   // ì„ íƒëœ ì˜µì…˜ ì •ë³´ {color: "ë¸”ë™", size: "265"}
  order              Order   @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product            Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  variant            ProductVariant? @relation(fields: [variantId], references: [id], onDelete: SetNull)

  @@map("order_items")
}

model ProductQuestion {
  id          String   @id @default(cuid())
  productId   String
  product     Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  question    String   @db.Text
  isAnswered  Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  answers     ProductAnswer[]

  @@map("product_questions")
}

model ProductAnswer {
  id          String   @id @default(cuid())
  questionId  String
  question    ProductQuestion @relation(fields: [questionId], references: [id], onDelete: Cascade)
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  answer      String   @db.Text
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("product_answers")
}

model Category {
  id          String   @id @default(cuid())
  name        String   @unique
  slug        String   @unique
  description String?  @db.Text
  image       String?
  icon        String?
  order       Int      @default(0)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("categories")
}
